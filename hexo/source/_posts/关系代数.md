---
layout: post
title: 关系代数
date: 2018-10-04 20:57:34
categories: data-base
mathjax: true
description: 传统的集合运算和专门的关系运算
---
关系代数是一种抽象的**查询语言**，它通过对关系的运算来表达查询。

关系代数用到的运算符包括两类：
- 集合运算符
- 专门的关系运算符

关系代数的运算按照运算符的不同可以分为**传统的集合运算和专门的关系运算两类**。
其中，传统的集合运算将关系看出元组的集合，**其运算是从关系的“水平”方向，即从行的角度来进行**；而专门的关系运算不仅涉及行，而且涉及列。
## 传统的集合运算
传统的集合运算时二目运算，包括并、差、交、笛卡儿积四种运算。

**前提**:关系R和关系S具有相同的目n，且对应的属性取自相同的域。
### 并(union)
关系R与关系S的并记作：
`R∪S={t|t∈R∨t∈S}`

### 差(except)
关系R和关系S的差记作：
`R-S={t|t∈R∧t∉S}`

### 交
`R∩S={t|t∈R∧t∈S}`

关系的交可以用差来表示，即R∩S=R-(R-S).
### 笛卡儿积
这里的笛卡儿积是指**广义的笛卡儿积(extended cartesian product),因为这里的笛卡儿积的元素是元组。**

**注**：普通的笛卡儿积是在域上的一种集合运算。

**定义**：两个分别为n目和m目的关系R和S的笛卡儿积是一个(n+m)目列元组集合。元组的前n列是关系R的一个元组，后m列是关系S的一个元组。若R中有k1个元组，S有k2个元组，则关系R和关系S的笛卡儿积有k1×k2个元组。记作：

R×S={ ${\hat{t_rt_s}|t_r∈R∧t_s∈S}$ }

![](/uploads/traditionalOperation.png)

## 专门的关系运算
专门的关系运算包括选择、投影、连接、除运算等。

### 选择(selection)
选择又称为限制(restriction)，它是在关系R中选择满足给定条件的**元组**，记作：
$\sigma_F(R)$={t|t∈R且F(t)=true}

例如，在下面的学生关系中选择年龄小于20岁的学生：

Sno|Sname|Ssex|Sage|Sdept
---|---|---|---|---
201215121|李勇|男|20|CS
201215122|刘晨|女|19|CS
201215123|王敏|女|18|MA
201215125|张立|男|19|IS

通过查询:$\sigma_{Sage<20}(Student)$得到下面的表：

Sno|Sname|Ssex|Sage|Sdept
---|---|---|---|---
201215122|刘晨|女|19|CS
201215123|王敏|女|18|MA
201215125|张立|男|19|IS

### 投影(projection)
关系R上的投影是从R中选择若干**属性列**组成新的关系，记作：
$\prod_A(R)$={t[A]|t∈R}
其中A为R中的列。投影操作是从列的角度进行的操作。
比如在学生关系中查询学生的姓名和所在系，结果如下：

Sname|Sdept
---|---
李勇|CS
刘晨|CS
王敏|MA
张立|IS

### 连接(join)
连接也称为$\theta$连接,它是从两个关系的笛卡儿积中选取属性间满足一定条件的元组。记作：
R⋈S={$\hat{t_rt_s}|t_r∈R∧t_s∈S∧t_r[A] {\theta}t_s[B]$}
其中，A、B分别为R和S上**列数相等且可比**的属性组。
#### 等值连接(equijoin)
$\theta$为“=”的连接运算称为等值连接。

![](https://gss3.bdstatic.com/-Po3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D250/sign=509b7231ba119313c343f8b5553a0c10/f2deb48f8c5494eef3c7b3ea25f5e0fe98257e5f.jpg)
#### 自然连接
**自然连接**是一种特殊的等值连接，它要求两个关系中进行比较的分量必须是**同名的属性组**，并且**在结果中把重复的属性列去掉**

![](/uploads/naturalJoin.png)

#### 外连接
**定义**：在进行自然连接的过程中，被舍弃的元组称为**悬浮元组（dangling tuple）**。
**定义**：如果把悬浮元组也保存在结果中，而在其他属性上填空值(NULL)，那么这种连接就叫做**外连接**，记作R⋈S。如果只保留左边关系R中的悬浮元组，则称为**左外连接**；如果只保留右边关系S中的悬浮元组，则称为**右外连接**。

#### Example

![](/uploads/exampleOfJoin.png)

![](/uploads/outerJoin.png)

### 除运算(division)
#### 定义

**象集**：象集的本质是一次选择运算和一次投影运算：
例如关系模式R(X, Y)，X和Y表示互为补集的两个属性集，对于遵循模式R的某个关系A，
当t[X]=x时，x在A中的象集（Images Set）为：
Zx={ t[Z] | t ∈ A，t[X]=x }
它表示：A中X分量等于x的元组集合在属性集Z上的投影。
如R：

X|Y|Z
---|---|---
a1|b1| c2
a2 |b3 |c7
a3 |b4 |c6
a1 |b2| c3
a4 |b6 |c6
a2 |b2| c3
a1 |b2 |c1
a1在R中的象集为{(b1,c2),(b2,c3),(b2,c1)}

下面用象集来定义除法：
给定关系R(X,Y)和S(Y,Z),其中X,Y,Z为属性组。R中的Y和S中的Y可以有不同的属性名，但是必须出自同一个域。
定义：

![](/uploads/imageSet.png)

#### Example
假设R和S分别为下表：

A|B|C
---|---|---
a1|b1| c2
a2 |b3 |c7
a3 |b4 |c6
a1 |b2| c3
a4 |b6 |c6
a2 |b2| c3
a1 |b2 |c1

B|C|D
---|---|---
b1|c2|d1
b2|c1|d1
b2|c3|d2

在关系R中，A的取值为{a1,a2,a3,a4}
a1的象集为{(b1,c2),(b2,c3),(b2,c1)}
a2的象集为{(b3,c7),(b2,c3)}
a3的象集为{(b4,c6)}
a4的象集为{(b6,c6)}

S在(B,C)上的投影为{(b1,c2),(b2,c1),(b2,c3)}

显然只有a1的象集包含了S在(B,C)上的投影，所以R÷S={a1}
