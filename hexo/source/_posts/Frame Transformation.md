---
layout: post
title: 标架的变换
date: 2018-10-31 21:33:48
categories: 计算机图形学
mathjax: true
---
### 基本概念
**线性无关相关(linearlyindependent)：** 在向量空间中，如果一组向量中的任何一个向量都不能够由其他向量通过标量-向量乘法和向量-向量加法表示，那么称这组向量是**线性无关**的。
**基(basis)**： 在一个三维空间中，可以用任意三个**线性无关**的向量$$v_{1},v_{2},v_{3}$$把任意一个向量$w$表示为
$$w = \alpha_{1} v_{1} + \alpha_{2} v_{2} + \alpha_{3} v_{3} $$
则称$$v_{1},v_{2},v_{3}$$为**基**，$$\alpha_{1},\alpha_{2},\alpha_{3}$$为基的**分量(component)**。
我们可以把$w$关于这个基的表示写成**列矩阵**的形式
$$\alpha=\begin{bmatrix}
\alpha_1\\
\alpha_2 \\
\alpha_3
\end{bmatrix}
$$
$$v=\begin{bmatrix}
v_1\\
v_2 \\
v_3
\end{bmatrix}
$$
$$
w=\alpha^{T}
\begin{bmatrix}
v_1\\
v_2 \\
v_3
\end{bmatrix}
= \alpha^{T} v
$$
<!--more-->
**标架(Frame)**: 原点和基向量决定了一个**标架**。
在一个给定的标架下，每一个**向量**可以唯一地表示为
$$w = \alpha_{1} v_{1} + \alpha_{2} v_{2} + \alpha_{3} v_{3} = a^{T}v$$
每一个点可以唯一地表示为
$$P =P_{0} + \beta_{1} v_{1} + \beta_{2} v_{2} + \beta_{3} v_{3} = b^{T}v$$

**齐次坐标**： 为了区分向量和点，我们在原来三维的基础上添加了一维，第四维如果是1则表示点，如果是0则表示向量。
在$$(v_{1},v_{2},v_{3},P_{0})$$表示的标架中，任何一个点P可以唯一地表示为
$$P =P_{0} + \beta_{1} v_{1} + \beta_{2} v_{2} + \beta_{3} v_{3}$$
用矩阵乘法把P形式化地表示为
$$P=[\alpha_{1},\alpha_{2},\alpha_{3},1]\begin{bmatrix}
v_1\\
v_2 \\
v_3\\
P_{0}
\end{bmatrix}$$
其中等式的右边是点P在由$$v_{1},v_{2},v_{3},P_{0}$$所确定的标架下的**齐次坐标表示**。等价地说，P的表示是下面的**列矩阵**
$$P=
\begin{bmatrix}
\alpha_{1}\\
\alpha_{2}\\
\alpha_{3}\\
1
\end{bmatrix}
$$
同理，我们也可以用一个**列矩阵**来表示向量
$$
w=\begin{bmatrix}
\beta_{1} \\
\beta_{2} \\
\beta_{3} \\
0
\end{bmatrix}
$$

### 标架转换
首先，在将标架转换之前，我需要先说明一个齐次坐标下的标架的性质：
*如果$$(v_{1},v_{2},v_{3},P_{0})$$和$${u_{1},u_{2},u_{3},Q_{0}}$$是两个标架，那么我们可以把第二个标架的基向量和参考点用第一个标架来表示*
$$
u_{1}=\gamma_{11}v_{1}+\gamma_{12}v_{2}+\gamma_{13}v_{3}

\\
u_{2}=\gamma_{21}v_{1}+\gamma_{22}v_{2}+\gamma_{23}v_{3}

\\
u_{3}=\gamma_{31}v_{1}+\gamma_{32}v_{2}+\gamma_{33}v_{3}

\\
Q_{0}=\gamma_{41}v_{1}+\gamma_{42}v_{2}+\gamma_{43}v_{3}+P_{0}
$$

然后我们可以写成下面这种形式：
$$u=Mv$$
其中
$$M=\begin{bmatrix}
\gamma_{11}&\gamma_{12}&\gamma_{13}&0\\
\gamma_{21}&\gamma_{22}&\gamma_{23}&0\\
\gamma_{31}&\gamma_{32}&\gamma_{33}&0\\
\gamma_{41}&\gamma_{42}&\gamma_{43}&1\\
\end{bmatrix}
$$

假设$a$和$b$分别是两个标架的向量(或者点)。于是有：
$$
b^{T}
\begin{bmatrix}
u_{1}\\
u{2}\\
u{3}\\
Q_{0}
\end{bmatrix}
=
b^{T}M
\begin{bmatrix}
v_{1}\\
v{2}\\
v{3}\\
P_{0}
\end{bmatrix}
=
a^{T}
\begin{bmatrix}
v_{1}\\
v{2}\\
v{3}\\
P_{0}
\end{bmatrix}
$$
于是有
$$b^{T}M=a^{T}$$
上式两边取逆操作，得到：
$$a=bM^{T}$$
于是
$$b=(M^{T})^{-1}a$$

### 举例
今天在做实验的时候遇到一个问题，鼠标回调函数获取的坐标是在窗口的坐标系上的，而世界坐标系却是在窗口的中央。但是我就需要把鼠标回调的坐标转换到世界坐标系上，于是这就可以应用我们的标架转换的方法了。假设窗口的长和宽都为500.(虽然这个转换是二维的，但是我们的方法是针对3维的，二维也是三维的一种特殊情况)
![](\uploads\frame_example.jpg)
我们可以抽象出下面的信息：
对于窗口坐标系： 
- 基向量为
  $$v_{1}=(0,1,0),v_{2}=(0,-1,0),v_{3}=(0,0,1)(v_{3}只要和其它向量满足线性无关即可)$$
- 原点$P_{0}$可以定为(0,0)  

对于世界坐标系：
- 基向量为
  $$u_{1}=(0,1,0),u_{2}=(0,1,0),u_{3}=(0,0,1)(u_{3}只要和其它向量满足线性无关即可)$$
- 原点$Q_{0}$为(250,250)

于是可以知道
$$
u_{1}=v_{1} \\
u_{2}=-u_{2} \\
u_{3}=u_{3} \\
Q_{0}=250v_{1}+250v_{2}
$$

所以
$$
M=\begin{bmatrix}
1&0&0&0\\
0&-1&0&0\\
0&0&1&0\\
250&250&0&1
\end{bmatrix}
$$

所以
$$
M^T=\begin{bmatrix}
1&0&0&250\\
0&-1&0&250\\
0&0&1&0\\
0&0&0&1
\end{bmatrix}
$$

所以
$$
(M^T)^{-1}=\begin{bmatrix}
1&0&0&-250\\
0&-1&0&250\\
0&0&1&0\\
0&0&0&1
\end{bmatrix}
$$

所以得到在世界坐标系的点u和窗口坐标系的点v有以下的关系
$$
u=(M^T)^{-1}v=\begin{bmatrix}
1&0&0&-250\\
0&-1&0&250\\
0&0&1&0\\
0&0&0&1
\end{bmatrix}v
$$

然后根据矩阵乘法，得到：
$$
\begin{bmatrix}
u.x \\
u.y \\
u.z \\
1 \\
\end{bmatrix}
=\begin{bmatrix}
1&0&0&-250\\
0&-1&0&250\\
0&0&1&0\\
0&0&0&1
\end{bmatrix}
\begin{bmatrix}
v.x\\
v.y\\
v.z\\
1\\
\end{bmatrix}
=
\begin{bmatrix}
v.x-250 \\
-v.y+250 \\
v.z \\
1 \\
\end{bmatrix}
$$

所以
$$
u.x=v.x-250\\
u.y=-v.y+250
$$
这就是我们从窗口坐标系的点转换到世界坐标系上的点。
