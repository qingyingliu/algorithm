---
layout: post
title: 关系的完整性
date: 2018-10-04 16:04:09
categories: data-base
mathjax: true
description: 实体完整性、参照完整性、用户定义完整性
---
关系模型中的完整性规则是**对关系的某种约束条件**。也就是说关系的值随着时间变化时应该满足一些约束条件。
关系模型中有三类完整性约束：**实体完整性(entity integrity)、参照完整性(referential integrity)和用户定义的完整性(user-defined integrity)**。其中实体完整性和参照完整性是关系模型必须满足的完整性约束条件，被称作**关系的两个不变性**，应该由系统自动支持。

## 实体完整性
**规则**：若属性（指一个或一组属性）A是基本关系R的主属性，则A不能取空值(null value)。所谓空值就是“不知道”或者“不存在”或者“无意义”的值。
例如，学生（学号，姓名，性别，专业号，年龄）关系中，学号为主码，则学号不能取空值。

**注意**：如果主码由若干属性组成，则所有这些主属性的值都不能取空值。

对于实体完整性的说明如下：
1. 实体完整性规则是针对**基本关系**而言的。一个基本表通常对应现实世界的一个实体集。例如学生关系对应于学生集合。
2. 现实世界中的实体是**可区分的**，即它们具有某种唯一性的标识。例如，每个学生都是独立的个体，是不一样的。
3. 相应的，关系模型中以**主码**作为唯一标识。
4. 主码中的属性即主属性不能取空值。如果主属性取空值，那么就说明存在某个不可标识的实体，这和第2点矛盾。因此这个规则称为实体完整性。

## 参照完整性
**定义**：设F是基本关系R的一个或者一组属性，**但不是主码**，$K_s$是基本关系S的主码。
如果**F与$K_s$对应**，则称F是R的**外码(Foreign key)**，并称基本关系R为**参照关系(referencing relation)**,基本关系S为**被参照关系(referenced relation)**或者**目标关系(target relation)**。

![](/uploads/referenceRelation.png)

**Example**

学生实体和专业实体可以用下面的关系表示，其中主码用粗体表示：

- 学生(**学号**，姓名，性别，专业号，年龄)
- 专业（**专业号**，专业名）

这两个关系之间存在着属性的引用，即**学生关系引用了专业关系的主码“专业号”**。显然，学生关系中的“专业号”值必须是确实存在的专业的专业号，即专业关系中有该记录。也就是说，**学生关系中的某个属性的取值需要参照专业关系的属性取值。**

同一关系内部属性间也可能存在引用关系：

在学生(**学号**，姓名，性别，专业号，年龄，班长)关系中，“学号”属于主码，“班长”表示该学生班级的班长的学号，它引用了本关系的“学号”属性。即**“班长”必须是确实存在的学生的学号。**

**参照完整性就是定义外码和主码之间的引用规则。**

**规则**：若属性（或属性组）F是基本关系R的外码，它与基本关系S的主码$K_s$相对应，则对于R中的每一个元组在F上的值必须：
- 或者取空值（F的每个属性均为空值）
- 或者等于S中某个元组的主码值

例如，上面的学生关系和专业关系中，对于学生关系中的专业号，只能取下面两类值：
- 空值，表示尚为给学生分配专业
- 非空值，这时该值必须是专业关系中的某个元组的专业号的值，表示该学生不可能分配到一个不存在的专业。**即被参照关系”专业“中一定存在一个元组，它的主码的值等于参照关系”学生“中的外码值。**

## 用户定义的完整性
不同的关系数据库根据其应用环境的不同，往往还需要一些特殊的约束条件。

**用户定义的完整性**就是针对某一具体关系数据库的约束条件，它反映某一具体应用所涉及的数据必须满足语义要求。

**Example**

- 学生不能没有名字，则可以定义学生姓名不能取空值。
- 学生的成绩，取值可以设置在[0,100]